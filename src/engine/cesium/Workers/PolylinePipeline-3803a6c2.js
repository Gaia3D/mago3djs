define(["exports","./Cartesian2-8646c5a1","./when-54335d57","./Check-24483042","./EllipsoidGeodesic-cc216670","./EllipsoidRhumbLine-2b7999f3","./IntersectionTests-5394f658","./Math-d6182036","./Transforms-79117a7b","./Plane-13ae4b1b"],function(a,w,P,e,r,v,m,T,y,A){"use strict";var b={numberOfPoints:function(a,e,r){var t=w.Cartesian3.distance(a,e);return Math.ceil(t/r)},numberOfPointsRhumbLine:function(a,e,r){var t=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2);return Math.max(1,Math.ceil(Math.sqrt(t/(r*r))))}},o=new w.Cartographic;b.extractHeights=function(a,e){for(var r=a.length,t=new Array(r),n=0;n<r;n++){var i=a[n];t[n]=e.cartesianToCartographic(i,o).height}return t};var E=new y.Matrix4,R=new w.Cartesian3,M=new w.Cartesian3,S=new A.Plane(w.Cartesian3.UNIT_X,0),D=new w.Cartesian3,x=new A.Plane(w.Cartesian3.UNIT_X,0),N=new w.Cartesian3,G=new w.Cartesian3,I=[];function k(a,e,r){var t=I;if(t.length=a,e===r){for(i=0;i<a;i++)t[i]=e;return t}for(var n=(r-e)/a,i=0;i<a;i++){var o=e+i*n;t[i]=o}return t}var V=new w.Cartographic,L=new w.Cartographic,_=new w.Cartesian3,O=new w.Cartesian3,B=new w.Cartesian3,U=new r.EllipsoidGeodesic,z=new v.EllipsoidRhumbLine;function X(a,e,r,t,n,i,o,s){var c=t.scaleToGeodeticSurface(a,O),l=t.scaleToGeodeticSurface(e,B),u=b.numberOfPoints(a,e,r),h=t.cartesianToCartographic(c,V),g=t.cartesianToCartographic(l,L),f=k(u,n,i);U.setEndPoints(h,g);var C=U.surfaceDistance/u,p=s;h.height=n;var d=t.cartographicToCartesian(h,_);w.Cartesian3.pack(d,o,p),p+=3;for(var v=1;v<u;v++){var m=U.interpolateUsingSurfaceDistance(v*C,L);m.height=f[v],d=t.cartographicToCartesian(m,_),w.Cartesian3.pack(d,o,p),p+=3}return p}function q(a,e,r,t,n,i,o,s){var c=t.cartesianToCartographic(a,V),l=t.cartesianToCartographic(e,L),u=b.numberOfPointsRhumbLine(c,l,r);c.height=0,l.height=0;var h=k(u,n,i);z.ellipsoid.equals(t)||(z=new v.EllipsoidRhumbLine(void 0,void 0,t)),z.setEndPoints(c,l);var g=z.surfaceDistance/u,f=s;c.height=n;var C=t.cartographicToCartesian(c,_);w.Cartesian3.pack(C,o,f),f+=3;for(var p=1;p<u;p++){var d=z.interpolateUsingSurfaceDistance(p*g,L);d.height=h[p],C=t.cartographicToCartesian(d,_),w.Cartesian3.pack(C,o,f),f+=3}return f}b.wrapLongitude=function(a,e){var r=[],t=[];if(P.defined(a)&&0<a.length){e=P.defaultValue(e,y.Matrix4.IDENTITY);var n=y.Matrix4.inverseTransformation(e,E),i=y.Matrix4.multiplyByPoint(n,w.Cartesian3.ZERO,R),o=w.Cartesian3.normalize(y.Matrix4.multiplyByPointAsVector(n,w.Cartesian3.UNIT_Y,M),M),s=A.Plane.fromPointNormal(i,o,S),c=w.Cartesian3.normalize(y.Matrix4.multiplyByPointAsVector(n,w.Cartesian3.UNIT_X,D),D),l=A.Plane.fromPointNormal(i,c,x),u=1;r.push(w.Cartesian3.clone(a[0]));for(var h=r[0],g=a.length,f=1;f<g;++f){var C,p,d=a[f];(A.Plane.getPointDistance(l,h)<0||A.Plane.getPointDistance(l,d)<0)&&(C=m.IntersectionTests.lineSegmentPlane(h,d,s,N),P.defined(C)&&(p=w.Cartesian3.multiplyByScalar(o,5e-9,G),A.Plane.getPointDistance(s,h)<0&&w.Cartesian3.negate(p,p),r.push(w.Cartesian3.add(C,p,new w.Cartesian3)),t.push(u+1),w.Cartesian3.negate(p,p),r.push(w.Cartesian3.add(C,p,new w.Cartesian3)),u=1)),r.push(w.Cartesian3.clone(a[f])),u++,h=d}t.push(u)}return{positions:r,lengths:t}},b.generateArc=function(a){P.defined(a)||(a={});var e=a.positions,r=e.length,t=P.defaultValue(a.ellipsoid,w.Ellipsoid.WGS84),n=P.defaultValue(a.height,0),i=Array.isArray(n);if(r<1)return[];if(1===r){var o,s=t.scaleToGeodeticSurface(e[0],O);return 0!==(n=i?n[0]:n)&&(o=t.geodeticSurfaceNormal(s,_),w.Cartesian3.multiplyByScalar(o,n,o),w.Cartesian3.add(s,o,s)),[s.x,s.y,s.z]}var c,l=a.minDistance;P.defined(l)||(c=P.defaultValue(a.granularity,T.CesiumMath.RADIANS_PER_DEGREE),l=T.CesiumMath.chordLength(c,t.maximumRadius));for(var u=0,h=0;h<r-1;h++)u+=b.numberOfPoints(e[h],e[h+1],l);var g=3*(u+1),f=new Array(g),C=0;for(h=0;h<r-1;h++)C=X(e[h],e[h+1],l,t,i?n[h]:n,i?n[h+1]:n,f,C);I.length=0;var p=e[r-1],d=t.cartesianToCartographic(p,V);d.height=i?n[r-1]:n;var v=t.cartographicToCartesian(d,_);return w.Cartesian3.pack(v,f,g-3),f};var W=new w.Cartographic,Y=new w.Cartographic;b.generateRhumbArc=function(a){P.defined(a)||(a={});var e=a.positions,r=e.length,t=P.defaultValue(a.ellipsoid,w.Ellipsoid.WGS84),n=P.defaultValue(a.height,0),i=Array.isArray(n);if(r<1)return[];if(1===r){var o,s=t.scaleToGeodeticSurface(e[0],O);return 0!==(n=i?n[0]:n)&&(o=t.geodeticSurfaceNormal(s,_),w.Cartesian3.multiplyByScalar(o,n,o),w.Cartesian3.add(s,o,s)),[s.x,s.y,s.z]}for(var c,l=P.defaultValue(a.granularity,T.CesiumMath.RADIANS_PER_DEGREE),u=0,h=t.cartesianToCartographic(e[0],W),g=0;g<r-1;g++)c=t.cartesianToCartographic(e[g+1],Y),u+=b.numberOfPointsRhumbLine(h,c,l),h=w.Cartographic.clone(c,W);var f=3*(u+1),C=new Array(f),p=0;for(g=0;g<r-1;g++)p=q(e[g],e[g+1],l,t,i?n[g]:n,i?n[g+1]:n,C,p);I.length=0;var d=e[r-1],v=t.cartesianToCartographic(d,V);v.height=i?n[r-1]:n;var m=t.cartographicToCartesian(v,_);return w.Cartesian3.pack(m,C,f-3),C},b.generateCartesianArc=function(a){for(var e=b.generateArc(a),r=e.length/3,t=new Array(r),n=0;n<r;n++)t[n]=w.Cartesian3.unpack(e,3*n);return t},b.generateCartesianRhumbArc=function(a){for(var e=b.generateRhumbArc(a),r=e.length/3,t=new Array(r),n=0;n<r;n++)t[n]=w.Cartesian3.unpack(e,3*n);return t},a.PolylinePipeline=b});
