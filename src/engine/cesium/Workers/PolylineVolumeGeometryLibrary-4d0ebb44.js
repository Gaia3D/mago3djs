define(["exports","./Cartesian2-8646c5a1","./Transforms-79117a7b","./EllipsoidTangentPlane-325a8e68","./Math-d6182036","./PolylinePipeline-3803a6c2"],function(a,L,P,E,j,Q){"use strict";var F=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),U=[new L.Cartesian3,new L.Cartesian3],_=new L.Cartesian3,q=new L.Cartesian3,Y=new L.Cartesian3,Z=new L.Cartesian3,k=new L.Cartesian3,H=new L.Cartesian3,J=new L.Cartesian3,K=new L.Cartesian3,W=new L.Cartesian3,X=new L.Cartesian3,f=new L.Cartesian3,$={},aa=new L.Cartographic;function ea(a,e,r,n){var t=a[0],i=a[1],s=L.Cartesian3.angleBetween(t,i),o=Math.ceil(s/n),l=new Array(o);if(e===r){for(c=0;c<o;c++)l[c]=e;return l.push(r),l}for(var C=(r-e)/o,c=1;c<o;c++){var u=e+c*C;l[c]=u}return l[0]=e,l.push(r),l}var M=new L.Cartesian3,T=new L.Cartesian3;var B=new L.Cartesian3(-1,0,0),z=new P.Matrix4,S=new P.Matrix4,A=new P.Matrix3,b=P.Matrix3.IDENTITY.clone(),D=new L.Cartesian3,O=new P.Cartesian4,N=new L.Cartesian3;function ra(a,e,r,n,t,i,s,o){var l=D,C=O;z=P.Transforms.eastNorthUpToFixedFrame(a,t,z),l=P.Matrix4.multiplyByPointAsVector(z,B,l),l=L.Cartesian3.normalize(l,l);var c,u,y,m,d,p,f,g,w=(c=l,u=e,y=a,m=t,d=new E.EllipsoidTangentPlane(y,m),p=d.projectPointOntoPlane(L.Cartesian3.add(y,c,M),M),f=d.projectPointOntoPlane(L.Cartesian3.add(y,u,T),T),g=L.Cartesian2.angleBetween(p,f),0<=f.x*p.y-f.y*p.x?-g:g);A=P.Matrix3.fromRotationZ(w,A),N.z=i,z=P.Matrix4.multiplyTransformation(z,P.Matrix4.fromRotationTranslation(A,N,S),z);var h=b;h[0]=s;for(var v=0;v<o;v++)for(var x=0;x<r.length;x+=3)C=L.Cartesian3.fromArray(r,x,C),C=P.Matrix3.multiplyByVector(h,C,C),C=P.Matrix4.multiplyByPoint(z,C,C),n.push(C.x,C.y,C.z);return n}var l=new L.Cartesian3;function na(a,e,r,n,t,i,s){for(var o=0;o<a.length;o+=3){n=ra(L.Cartesian3.fromArray(a,o,l),e,r,n,t,i[o/3],s,1)}return n}function ta(a,e){for(var r=a.length,n=new Array(3*r),t=0,i=e.x+e.width/2,s=e.y+e.height/2,o=0;o<r;o++)n[t++]=a[o].x-i,n[t++]=0,n[t++]=a[o].y-s;return n}var g=new P.Quaternion,w=new L.Cartesian3,h=new P.Matrix3;function ia(a,e,r,n,t,i,s,o,l,C){var c,u=L.Cartesian3.angleBetween(L.Cartesian3.subtract(e,a,X),L.Cartesian3.subtract(r,a,f)),y=n===F.BEVELED?0:Math.ceil(u/j.CesiumMath.toRadians(5)),m=t?P.Matrix3.fromQuaternion(P.Quaternion.fromAxisAngle(L.Cartesian3.negate(a,X),u/(y+1),g),h):P.Matrix3.fromQuaternion(P.Quaternion.fromAxisAngle(a,u/(y+1),g),h);if(e=L.Cartesian3.clone(e,w),0<y)for(var d=C?2:1,p=0;p<y;p++)e=P.Matrix3.multiplyByVector(m,e,e),c=L.Cartesian3.subtract(e,a,X),c=L.Cartesian3.normalize(c,c),t||(c=L.Cartesian3.negate(c,c)),s=ra(i.scaleToGeodeticSurface(e,f),c,o,s,i,l,1,d);else c=L.Cartesian3.subtract(e,a,X),c=L.Cartesian3.normalize(c,c),t||(c=L.Cartesian3.negate(c,c)),s=ra(i.scaleToGeodeticSurface(e,f),c,o,s,i,l,1,1),r=L.Cartesian3.clone(r,w),c=L.Cartesian3.subtract(r,a,X),c=L.Cartesian3.normalize(c,c),t||(c=L.Cartesian3.negate(c,c)),s=ra(i.scaleToGeodeticSurface(r,f),c,o,s,i,l,1,1);return s}$.removeDuplicatesFromShape=function(a){for(var e=a.length,r=[],n=e-1,t=0;t<e;n=t++){var i=a[n],s=a[t];L.Cartesian2.equals(i,s)||r.push(s)}return r},$.angleIsGreaterThanPi=function(a,e,r,n){var t=new E.EllipsoidTangentPlane(r,n),i=t.projectPointOntoPlane(L.Cartesian3.add(r,a,M),M),s=t.projectPointOntoPlane(L.Cartesian3.add(r,e,T),T);return 0<=s.x*i.y-s.y*i.x};var sa=new L.Cartesian3,oa=new L.Cartesian3;$.computePositions=function(a,e,r,n,t){var i=n._ellipsoid,s=function(a,e){for(var r=new Array(a.length),n=0;n<a.length;n++){var t=a[n];aa=e.cartesianToCartographic(t,aa),r[n]=aa.height,a[n]=e.scaleToGeodeticSurface(t,t)}return r}(a,i),o=n._granularity,l=n._cornerType,C=(t?function(a,e){var r=a.length,n=new Array(6*r),t=0,i=e.x+e.width/2,s=e.y+e.height/2,o=a[0];n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s;for(var l=1;l<r;l++){var C=(o=a[l]).x-i,c=o.y-s;n[t++]=C,n[t++]=0,n[t++]=c,n[t++]=C,n[t++]=0,n[t++]=c}return o=a[0],n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s,n}:ta)(e,r),c=t?ta(e,r):void 0,u=r.height/2,y=r.width/2,m=a.length,d=[],p=t?[]:void 0,f=_,g=q,w=Y,h=Z,v=k,x=H,P=J,E=K,M=W,T=a[0],B=a[1],h=i.geodeticSurfaceNormal(T,h);f=L.Cartesian3.subtract(B,T,f),f=L.Cartesian3.normalize(f,f),E=L.Cartesian3.cross(h,f,E),E=L.Cartesian3.normalize(E,E);var z,S=s[0],A=s[1];t&&(p=ra(T,E,c,p,i,S+u,1,1)),M=L.Cartesian3.clone(T,M),T=B,g=L.Cartesian3.negate(f,g);for(var b=1;b<m-1;b++){var D=t?2:1,B=a[b+1],f=L.Cartesian3.subtract(B,T,f);f=L.Cartesian3.normalize(f,f),w=L.Cartesian3.add(f,g,w),w=L.Cartesian3.normalize(w,w),h=i.geodeticSurfaceNormal(T,h);var O=L.Cartesian3.multiplyByScalar(h,L.Cartesian3.dot(f,h),sa);L.Cartesian3.subtract(f,O,O),L.Cartesian3.normalize(O,O);var N,V,G=L.Cartesian3.multiplyByScalar(h,L.Cartesian3.dot(g,h),oa);L.Cartesian3.subtract(g,G,G),L.Cartesian3.normalize(G,G),!j.CesiumMath.equalsEpsilon(Math.abs(L.Cartesian3.dot(O,G)),1,j.CesiumMath.EPSILON7)?(w=L.Cartesian3.cross(w,h,w),w=L.Cartesian3.cross(h,w,w),w=L.Cartesian3.normalize(w,w),N=1/Math.max(.25,L.Cartesian3.magnitude(L.Cartesian3.cross(w,g,X))),(V=$.angleIsGreaterThanPi(f,g,T,i))?(v=L.Cartesian3.add(T,L.Cartesian3.multiplyByScalar(w,N*y,w),v),x=L.Cartesian3.add(v,L.Cartesian3.multiplyByScalar(E,y,x),x),U[0]=L.Cartesian3.clone(M,U[0]),U[1]=L.Cartesian3.clone(x,U[1]),z=ea(U,S+u,A+u,o),d=na(Q.PolylinePipeline.generateArc({positions:U,granularity:o,ellipsoid:i}),E,C,d,i,z,1),E=L.Cartesian3.cross(h,f,E),E=L.Cartesian3.normalize(E,E),P=L.Cartesian3.add(v,L.Cartesian3.multiplyByScalar(E,y,P),P),l===F.ROUNDED||l===F.BEVELED?ia(v,x,P,l,V,i,d,C,A+u,t):d=ra(T,w=L.Cartesian3.negate(w,w),C,d,i,A+u,N,D)):(v=L.Cartesian3.add(T,L.Cartesian3.multiplyByScalar(w,N*y,w),v),x=L.Cartesian3.add(v,L.Cartesian3.multiplyByScalar(E,-y,x),x),U[0]=L.Cartesian3.clone(M,U[0]),U[1]=L.Cartesian3.clone(x,U[1]),z=ea(U,S+u,A+u,o),d=na(Q.PolylinePipeline.generateArc({positions:U,granularity:o,ellipsoid:i}),E,C,d,i,z,1),E=L.Cartesian3.cross(h,f,E),E=L.Cartesian3.normalize(E,E),P=L.Cartesian3.add(v,L.Cartesian3.multiplyByScalar(E,-y,P),P),l===F.ROUNDED||l===F.BEVELED?ia(v,x,P,l,V,i,d,C,A+u,t):d=ra(T,w,C,d,i,A+u,N,D)),M=L.Cartesian3.clone(P,M),g=L.Cartesian3.negate(f,g)):(d=ra(M,E,C,d,i,S+u,1,1),M=T),S=A,A=s[b+1],T=B}U[0]=L.Cartesian3.clone(M,U[0]),U[1]=L.Cartesian3.clone(T,U[1]),z=ea(U,S+u,A+u,o),d=na(Q.PolylinePipeline.generateArc({positions:U,granularity:o,ellipsoid:i}),E,C,d,i,z,1),t&&(p=ra(T,E,c,p,i,A+u,1,1)),m=d.length;var R=t?m+p.length:m,I=new Float64Array(R);return I.set(d),t&&I.set(p,m),I},a.CornerType=F,a.PolylineVolumeGeometryLibrary=$});
