<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Cesium</title>
	<link rel="stylesheet" href="./demo.css" />
	<link rel="stylesheet" href="../src/engine/cesium/Widgets/widgets.css" />
	<link rel="stylesheet" href="../externlib/jquery-ui/jquery-ui.css" />
	<script type="text/javascript" src="../externlib/jquery/jquery.js"></script>
	
	<script type="text/javascript" src="../externlib/polyfill/decodeTextAlternative/encoding-indexes.js"></script>
	<script type="text/javascript" src="../externlib/polyfill/decodeTextAlternative/encoding.js"></script>
</head>

<body>
	<input type="hidden" id="now_latitude" name="now_latitude" value="" />
	<input type="hidden" id="now_longitude" name="now_longitude" value=""  />
<ul class="nav i18n">
	<li id="homeMenu" class="home">
		<img src="/images/ko/homepage/home-icon.png" style="width: 35px; height: 35px; padding-right: 2px;" title="Home" />
	</li>
	
	<li onclick="Chemical_Accident_Test();">
		Chemical Accident Test
	</li>
	<li onclick="Start();">
		ReStart animation
	</li>
	<li onclick="useCuttingPlaneXY();">
		Use cutting plane XY
	</li>
	<li onclick="useCuttingPlaneXZ();">
		Use cutting plane XZ
	</li>
	<li onclick="useCuttingPlaneYZ();">
		Use cutting plane YZ
	</li>
	<li onclick="noUseCuttingPlane();">
		No use cutting plane
	</li>
	<li onclick="useMinMaxValuesToRender();">
		Use minMax values to render
	</li>
	<li onclick="playPause();">
		play / pause
	</li>
	<li onclick="startItinerary();">
		start itinerary
	</li>
	<li onclick="chemicalAccident2d();">
		Chemical Accident 2D
	</li>
	<li onclick="swapTextureFilterType();">
		swap texture filter type
	</li>
	<li onclick="swapRenderBorder();">
		swap render border
	</li>
	<li onclick="swapRenderColorType2D();">
		swap render color type 2D
	</li>
	<li onclick="swapRenderColorType3D();">
		swap render color type 3D
	</li>
	<li onclick="swapIsDoRender2d();">
		swap isDoRender 2D
	</li>
	<li onclick="swapIsDoRender3d();">
		swap isDoRender 3D
	</li>
	<li onclick="swapItineraryIsDoRender();">
		swap isDoRender Itinerary
	</li>


</ul>
<div id="magoContainer" class="mapWrap"></div>


<script type="text/javascript" src="../src/engine/cesium/Cesium.js"></script>
<script type="text/javascript" src="../build/mago3d/mago3d.js"></script>
<!--<script type="text/javascript" src="../test/extrusion.js"></script> <!--  상암에 extrusion buildings 불러오기-->-->
<script>
	var message = new Mago3D.Message(i18next);
	
	//f4d path, default data array, 
	var dataInfo = {
		baseUrl : '/f4d',
		dataArrat : []
	}

	function changeLang(lang) 
	{
		if(i18next === undefined)
		{
			return;
		}
		
		var language = lang || i18next.language;
		var namespace = i18next.options.ns[0];

		$.ajax({
			url: "/locales/"+namespace+"/"+language+".json",
			type: "GET",
			dataType: "json",
			success: function(data){
				i18next.addResourceBundle(language, namespace, data, true, true);
				i18next.changeLanguage(language);
			},
			error: function(e){
				alert(e.responseText);
			}
		});
	}
	
	message.init(function (){
		i18next = message.getHandle();
		i18next.on('languageChanged', function (lang) {
			$('.i18n').localize();
		});
		//jqueryI18next.init(i18next, $);
		//changeLang();
	});

	var osmLayer;
	var MAGO3D_INSTANCE;
	var imagePath = "/images/ko";
	var dataInformationUrl = "/sample/persistence/json/";
	magoStart(null, "magoContainer", imagePath);

    // mago3d 시작, 정책 데이터 파일을 로딩
	function magoStart(viewer, renderDivId, imagePath) {
		$.ajax({
			url: dataInformationUrl + "geopolicy.json",
			type: "GET",
			dataType: "json",
			success: function(serverPolicy){
				var cesiumViewerOption = {};
				cesiumViewerOption.infoBox = false;
				cesiumViewerOption.navigationHelpButton = false;
				cesiumViewerOption.selectionIndicator = false;
				cesiumViewerOption.homeButton = false;
				cesiumViewerOption.fullscreenButton = false;
				cesiumViewerOption.geocoder = false;
				cesiumViewerOption.baseLayerPicker = false;
				cesiumViewerOption.sceneModePicker = false;

				cesiumViewerOption.defaultControl = false;
				cesiumViewerOption.defaultControl = {};
				cesiumViewerOption.defaultControl.zoom = false;
				cesiumViewerOption.defaultControl.initCamera = false;
				cesiumViewerOption.defaultControl.fullScreen = false;
				cesiumViewerOption.defaultControl.measure = false;
				cesiumViewerOption.defaultControl.tools = false;
				cesiumViewerOption.defaultControl.attribution = false;
				cesiumViewerOption.defaultControl.overviewMap = false;

				serverPolicy.basicGlobe = 'cesium';
				serverPolicy.initCameraEnable = true;
				serverPolicy.geoserverEnable = false;
				serverPolicy.geoserverImageproviderEnable = false;
				serverPolicy.terrainType = 'cesium-default';
				serverPolicy.initLatitude = 37.6168;
				serverPolicy.initLongitude = 127.1823;
				serverPolicy.initAltitude = 4000;


				//serverPolicy.terrainType = 'cesium-customer'; //serverPolicy.terrainType = 'cesium-default';
				//serverPolicy.terrainType = 'cesium-default';
				//serverPolicy.terrainValue = 'http://192.168.10.11:8887/tilesets/sejong/';
				//serverPolicy.terrainValue = 'http://192.168.10.182:9998/tilesets/terrain/';
				//serverPolicy.terrainValue = 'https://mago3d.net/tilesets/terrain/';


				//serverPolicy.terrainType = 'cesium-customer';
				//serverPolicy.terrainValue = '../f4d/terrain_ws2_sangam/terrain_ws2_sangam/';
				//serverPolicy.terrainValue = 'http://211.106.171.246:49998/tilesets/terrain_sj/'; // from Kim Jin Ho 20220420 (to test terrain excavation bugs).***
				//serverPolicy.terrainValue = 'http://175.197.92.213:10207/tilesets/terrain_ws2_sangam/';

				//var terrainUrl = '../f4d/terrainAsia_L8/';
				//var terrainUrl = '../f4d/terrainSejong20240704/';
				//var terrainUrl = '../f4d/terrainKorea_miniSeoul/';
				var terrainUrl = '../f4d/terrainAsia_L11/';
				//var terrainUrl = '../f4d/terrain_seoul_1/';

				//const url = "/terrain-sample/seoul-12bilinear/";
				const terrainProvider = Cesium.CesiumTerrainProvider.fromUrl(terrainUrl, {
					requestVertexNormals: true,
				})
				const terrain = new Cesium.Terrain(terrainProvider);
				
				serverPolicy.initLatitude = 37.6168;
				serverPolicy.initLongitude = 127.1823;
				serverPolicy.initAltitude = 4000;

				MAGO3D_INSTANCE = new Mago3D.Mago3d(renderDivId, serverPolicy, {loadend : loadend}, cesiumViewerOption);

				MAGO3D_INSTANCE.getViewer().scene.setTerrain(terrain);
				MAGO3D_INSTANCE.getViewer().scene.globe.enableLighting = true;
				//MAGO3D_INSTANCE.getViewer().scene.globe._surface._tileProvider._debug.wireframe = true;

				// https://searchcode.com/codesearch/view/93566826/
				addAdditionalLayerOption( 'Tile Coordinates', new Cesium.TileCoordinatesImageryProvider(), 1.0, true );

				// // Active this code for tile inspector.**************************************************************************************
				// MAGO3D_INSTANCE.getViewer().extend(Cesium.viewerCesium3DTilesInspectorMixin);
        		// const inspectorViewModel = MAGO3D_INSTANCE.getViewer().cesium3DTilesInspector.viewModel;
				// inspectorViewModel.pickActive = true;
				// // Active this code for tile inspector.**************************************************************************************
				
				
				//MAGO3D_INSTANCE.getViewer().scene.globe.translucency.enabled = true;
				//MAGO3D_INSTANCE.getViewer().scene.globe.translucency.frontFaceAlphaByDistance = new Cesium.NearFarScalar(300.0, 0.0, 3000.0, 1.0);
				// for Cesium v1.3.2.******************************************************************************
				// var urlTest = "../f4d/3dtiles/fbx_HayashiSan/tileset.json";
				// try{
				// MAGO3D_INSTANCE.getViewer().scene.primitives.add(Cesium.Cesium3DTileset.fromUrl(urlTest));
				// } catch (error) {
				// console.log(`Error loading tileset: ${error}`);
				// }

				// urlTest = "../f4d/3dtiles/sejeong_citygml/tileset.json";
				// MAGO3D_INSTANCE.getViewer().scene.primitives.add(new Cesium.Cesium3DTileset({
				// 	url : urlTest
				// }));

				// urlTest = "../f4d/3dtiles/SejongBuildings_3ds/tileset.json";
				// MAGO3D_INSTANCE.getViewer().scene.primitives.add(new Cesium.Cesium3DTileset({
				// 	url : urlTest
				// }));
				//-------------------------------------------------------------------------------------------------
				function addAdditionalLayerOption(name, imageryProvider, alpha, show) {
					var layer = MAGO3D_INSTANCE.getViewer().scene.imageryLayers.addImageryProvider(imageryProvider);
					layer.alpha = Cesium.defaultValue(alpha, 0.5);
					layer.show = Cesium.defaultValue(show, true);
					layer.name = name;
				}

			},
			error: function(e){
				alert(e.responseText);
			}
		});
	}
	async function loadend(e) {
		console.info('Complete construct mago3d instance. Enjoy!');
		
		var magoInstance = e;
		console.info(magoInstance)
		magoInstance.getViewer().scene.globe.depthTestAgainstTerrain = true;
		magoInstance.setBaseUrl(dataInfo.baseUrl);

		var urlTest = "../f4d/3dtiles/(20240712)상지대 콜라다 데이터_6buildings/tileset.json";
		//var urlTest = "../f4d/3dtiles/(20240712)상지대 콜라다 데이터_2buildings/tileset.json";
		//var urlTest = "../f4d/3dtiles/splittedTile/tileset.json";
		//var urlTest = "../f4d/3dtiles/Data_HanamKyosan/건물/tileset.json";
		//var urlTest = "../f4d/3dtiles/ComplicatedModels10/tileset.json";
		//var urlTest = "../f4d/3dtiles/fbx_HayashiSan/tileset.json";
		try{
			magoInstance.getViewer().scene.primitives.add(await Cesium.Cesium3DTileset.fromUrl(urlTest));
		} catch (error) {
		console.log(`Error loading tileset: ${error}`);
		}

		// Active this code for tile inspector.**************************************************************************************
		magoInstance.getViewer().extend(Cesium.viewerCesium3DTilesInspectorMixin);
		const inspectorViewModel = magoInstance.getViewer().cesium3DTilesInspector.viewModel;
		//inspectorViewModel.pickActive = true;
		// Active this code for tile inspector.**************************************************************************************


		/*osmLayer = new Cesium.ImageryLayer(new Cesium.OpenStreetMapImageryProvider({
			url : 'https://a.tile.openstreetmap.org/'
		}));
		magoInstance.getViewer().imageryLayers.add(osmLayer, 1);
		*/


		osmLayer = await new Cesium.ImageryLayer(new Cesium.OpenStreetMapImageryProvider({
			url : 'https://tile.openstreetmap.org/'
		}));
		magoInstance.getViewer().imageryLayers.add(osmLayer);

		
		magoManager = magoInstance.getMagoManager();

		//let json = JSON.parse("{\"attributes\":{\"isPhysical\":false,\"nodeType\":\"root\",\"projectType\":\"workshop\",\"specularLighting\":true},\"children\":[{\"attributes\":{\"isPhysical\":true,\"nodeType\":\"workshop\",\"propertyFilter\":true},\"children\":[],\"data_key\":\"SOCIALROOM\",\"data_name\":\"SOCIALROOM\",\"mapping_type\":\"origin\",\"latitude\":37.52633678124275,\"longitude\":126.9286322593689,\"height\":100,\"heading\":0,\"pitch\":0,\"roll\":0},{\"attributes\":{\"isPhysical\":true,\"nodeType\":\"workshop\",\"propertyFilter\":false},\"children\":[],\"data_key\":\"STUDENTROOM\",\"data_name\":\"STUDENTROOM\",\"mapping_type\":\"origin\",\"latitude\":37.52633678124275,\"longitude\":126.9286322593689,\"height\":100,\"heading\":0,\"pitch\":0,\"roll\":0},{\"attributes\":{\"isPhysical\":true,\"nodeType\":\"workshop\",\"propertyFilter\":false},\"children\":[],\"data_key\":\"Tile_1\",\"data_name\":\"Tile_1\",\"mapping_type\":\"origin\",\"latitude\":37.52633678124275,\"longitude\":126.9286322593689,\"height\":50,\"heading\":0,\"pitch\":0,\"roll\":0}],\"parent\":0,\"depth\":1,\"view_order\":2,\"data_key\":\"sample\",\"data_name\":\"sample\",\"mapping_type\":\"origin\"}")
		//magoInstance.getF4dController().addF4dGroup(json);

		//************************************************************************************
		//************************************************************************************
		const pinBuilder = new Cesium.PinBuilder();
		const position = Cesium.Cartesian3.fromDegrees(127, 37.5);

		const billboard = {

			image: pinBuilder.fromText('손성도', Cesium.Color.RED, 128).toDataURL(),

			verticalOrigin: Cesium.VerticalOrigin.BOTTOM,


		};
		//magoInstance.getViewer().entities.add({
		//	position,
		//	billboard
		//})

		var r = Math.random() * 0.5 + 0.5;
		var g = Math.random() * 0.5 + 0.5;
		var b = Math.random() * 0.5 + 0.5;
		/*magoManager.gjMaster = magoManager.addKoreaBuildingMaster('https://dtdata.cdn.ntruss.com/buildingmaster/gwangju/15/', 'geojson', {
			show : true,
			color : new self.Mago3D.Color(r, g, b ,1)
		});*/

		//magoManager.gjMaster = magoManager.addKoreaBuildingMaster('https://dtdata.cdn.ntruss.com/buildingmaster/seoul/15/', 'geojson', {
		//	show : true,
		//	/* color : new self.Mago3D.Color(241/255, 231/255, 200/255 ,1) */
		//	color : new self.Mago3D.Color(r, g, b ,1)
		//});

		//===================================================================================
		//===================================================================================
		
		
		magoManager.on(Mago3D.MagoManager.EVENT_TYPE.CLICK, function(e){
			console.info(e);

		
			
			// Do a test. Create a geoCoord and render it.
			
			var screenX = e.point.screenCoordinate.x;
			var screenY = e.point.screenCoordinate.y;
			var options = {
				highPrecision : false
			};
			
			var posWC = Mago3D.ManagerUtils.screenCoordToWorldCoordUseDepthCheck(screenX, screenY, magoManager, options);
			var geoCoord = Mago3D.ManagerUtils.pointToGeographicCoord(posWC, undefined);
			geoCoord.altitude += 4.0; //
			geoCoord.makeDefaultGeoLocationData();

			// check if mago is or not in selection & move mode.***
			var geoCoordsList = magoManager.modeler.getGeographicCoordsList();
			geoCoordsList.addGeoCoord(geoCoord);
			
			var hola = 0;

			// test create a cylinder.*********************************************
			/*
			options = {
				radius : 10.0,
				height : 100.0,
				geographicCoord : {
					longitude : geoCoord.longitude,
					latitude : geoCoord.latitude,
					altitude : geoCoord.altitude
				},
				color4 : {
					r : 0.5, g : 0.25, b : 1.0, a : 1.0
				}
			};
			var cylinder = Mago3D.MagoRenderable.newCylinder(options);
			var tileDepth = 10;
			magoManager.modeler.addObject(cylinder, tileDepth);
			*/
			// End test create a cylinder.-----------------------------------------
			
			var hola = 0;
			// End test.----------------------------------
			/*
			// Do a cone creating test.
			var falloffDeg = 90;
			var falloffDistance = 40;
			var angRad = falloffDeg * Math.PI/180;
			var radius = falloffDistance * Math.sin(angRad);
			var height = falloffDistance * Math.cos(angRad);
			var color = new Mago3D.Color(0.95, 0.95, 0.95, 0.4);
			var options = {
					baseType : 2, // 0= NONE. 1= PLANE. 2= SPHERICAL.
					color : color,
					originType : 1 // 0= ATBASE, 1= ATVERTEX
			};
			var cone = new Mago3D.Cone(radius, height, options);
			cone.setGeographicPosition(geoCoord, undefined, undefined, undefined);
			magoManager.modeler.addObject(cone);
			*/
			// End cone test.------------------------------

			// Do a spotLightTest.****************************
			/*
			// Small opening.***
			var options = {
				hotspotDeg : 35.0,
				falloffDeg : 50.0,
				hotDistance : 50.0,
				falloffDistance : 60.0
			};

			// Medium opening.***
			var options = {
				hotspotDeg : 55.0,
				falloffDeg : 75.0,
				hotDistance : 50.0,
				falloffDistance : 60.0
			};
			
			var spotLight = new Mago3D.SpotLight(options);
			spotLight.setGeographicPosition(geoCoord, undefined, undefined, undefined);
			magoManager.modeler.addObject(spotLight);
			*/
			// End spotlightTest.-----------------------------
			
		});
	}

	function Start(){
		var magoManager = MAGO3D_INSTANCE.getMagoManager();

		if(magoManager.animationTimeController === undefined)
		{
			magoManager.animationTimeController = new Mago3D.AnimationTimeController(options);
		}

		var options = {
				timeScale : 2000,
				year : 2024,
				month : 2, // 0 to 11
				day : 6,
				hour : 11,
				minute : 0,
				second : 0
			};

		magoManager.animationTimeController.reset(options);
		magoManager.animationTimeController.startAnimation();
		
	}

	function playPause(){
		var magoManager = MAGO3D_INSTANCE.getMagoManager();

		if(magoManager.animationTimeController !== undefined)
		{
			magoManager.animationTimeController.switchPlayPause();
		}
	}


	function useCuttingPlaneXY()
	{
		var magoManager = MAGO3D_INSTANCE.getMagoManager();
		if(magoManager.chemicalAccidentManager !== undefined)
		{
			if(magoManager.chemicalAccidentManager.getChemicalAccidentLayersCount() > 0)
			{
				var chemicalAccidentLayer = magoManager.chemicalAccidentManager.getChemicalAccidentLayer(0);
				var idx = 2;
				chemicalAccidentLayer.setCurrentCuttingPlaneIdx(idx);
			}
		}
	}

	function useCuttingPlaneXZ()
	{
		var magoManager = MAGO3D_INSTANCE.getMagoManager();
		if(magoManager.chemicalAccidentManager !== undefined)
		{
			if(magoManager.chemicalAccidentManager.getChemicalAccidentLayersCount() > 0)
			{
				var chemicalAccidentLayer = magoManager.chemicalAccidentManager.getChemicalAccidentLayer(0);
				var idx = 0;
				chemicalAccidentLayer.setCurrentCuttingPlaneIdx(idx);
			}
		}
	}
	function useCuttingPlaneYZ()
	{
		var magoManager = MAGO3D_INSTANCE.getMagoManager();
		if(magoManager.chemicalAccidentManager !== undefined)
		{
			if(magoManager.chemicalAccidentManager.getChemicalAccidentLayersCount() > 0)
			{
				var chemicalAccidentLayer = magoManager.chemicalAccidentManager.getChemicalAccidentLayer(0);
				var idx = 1;
				chemicalAccidentLayer.setCurrentCuttingPlaneIdx(idx);
			}
		}
	}//

	function noUseCuttingPlane()
	{
		var magoManager = MAGO3D_INSTANCE.getMagoManager();
		if(magoManager.chemicalAccidentManager !== undefined)
		{
			if(magoManager.chemicalAccidentManager.getChemicalAccidentLayersCount() > 0)
			{
				var chemicalAccidentLayer = magoManager.chemicalAccidentManager.getChemicalAccidentLayer(0);
				var idx = -1;
				chemicalAccidentLayer.setCurrentCuttingPlaneIdx(idx);

				var cuttingPlanesCount = chemicalAccidentLayer.cuttingPlanesArray.length;
				for (var i=0; i<cuttingPlanesCount; i++)
				{
					var cuttingPlane = chemicalAccidentLayer.cuttingPlanesArray[i];
					if (cuttingPlane === undefined)
					{ continue; }

					cuttingPlane.attributes.isVisible = false;
				}
			}
		}
	}//

	function useMinMaxValuesToRender()
	{
		var magoManager = MAGO3D_INSTANCE.getMagoManager();
		if(magoManager.chemicalAccidentManager !== undefined)
		{
			if(magoManager.chemicalAccidentManager.getChemicalAccidentLayersCount() > 0)
			{
				var chemicalAccidentLayer = magoManager.chemicalAccidentManager.getChemicalAccidentLayer(0);
				if(chemicalAccidentLayer.useMinMaxValuesToRender === 1)
				{
					chemicalAccidentLayer.setUseMinMaxValuesToRender(0);
				}
				else if(chemicalAccidentLayer.useMinMaxValuesToRender === 0)
				{
					chemicalAccidentLayer.setUseMinMaxValuesToRender(1);
				}
			}
		}
	}

	function startItinerary()
	{
		// 1rst, delete existing itineraryLayers.***
		if(magoManager.itineraryManager)
		{
			magoManager.itineraryManager.deleteObjects(magoManager.vboMemoryManager);
			magoManager.itineraryManager = undefined;
		}

		var walkingManMosaicTexPath = "\\f4d\\result_personItinerary\\walk-right.png";
		var options = {
			magoManager : magoManager,
			walkingManMosaicTexPath : walkingManMosaicTexPath,
			walkingManMosaicColumnsCount : 6,
			walkingManMosaicRowsCount : 1
		};
		magoManager.itineraryManager = new Mago3D.ItineraryManager(options);
		var thickness = 4.0;

		var itinerariesCount = 30;
		var path;
		for(var i=0; i<itinerariesCount; i++)
		{
			var randomRed = Math.random();
			var randomGreen = Math.random();
			var randomBlue = Math.random();
			var num = i + 1;
			if(num < 10)
			{
				path = "\\f4d\\result_personItinerary\\USER00" + num + ".json";
			}
			else{
				path = "\\f4d\\result_personItinerary\\USER0" + num + ".json";
			}
			
			var layerOptions = {
				filePath : path,
				lineThickness : thickness,
				thickLineColor : {
					r : randomRed, g : randomGreen, b : randomBlue, a : 1.0
				}
			};

			magoManager.itineraryManager.newItineraryLayer(layerOptions);
		}


		// var path = "\\f4d\\result_personItinerary\\USER001.json";
		// var layerOptions = {
		// 	filePath : path,
		// 	lineThickness : thickness,
		// 	thickLineColor : {
		// 		r : 0.5, g : 0.25, b : 0.95, a : 1.0
		// 	}
		// };

		// magoManager.itineraryManager.newItineraryLayer(layerOptions);

		// path = "\\f4d\\result_personItinerary\\USER002.json";
		// layerOptions = {
		// 	filePath : path,
		// 	lineThickness : thickness,
		// 	thickLineColor : {
		// 		r : 1.0, g : 0.0, b : 0.0, a : 1.0
		// 	}
		// };

		magoManager.itineraryManager.newItineraryLayer(layerOptions);
		
		// var options = {
		// 	incrementalAddingTimeMilisec : 20
		// };

		// if(magoManager.animationTimeController === undefined)
		// {
		// 	magoManager.animationTimeController = new Mago3D.AnimationTimeController(options);
		// }

		//magoManager.animationTimeController.reset(options);
		//magoManager.animationTimeController._timeScale = 20;
		//magoManager.animationTimeController.startAnimation();

	}

	function swapItineraryIsDoRender()
	{
		if(magoManager.itineraryManager === undefined)
		{
			return;
		}

		var isDoRender = magoManager.itineraryManager.isShow();
		if(isDoRender === true)
		{
			magoManager.itineraryManager.hide();
		}
		else if(isDoRender === false)
		{
			magoManager.itineraryManager.show();
		}
	}

	function chemicalAccident2d()
	{
		var magoManager = MAGO3D_INSTANCE.getMagoManager();

		// create chemicalAccident2dManager, if no exist.***
		if(!magoManager.chemicalAccident2dManager)
		{
			var options = {
				magoManager : magoManager,
				url : "/f4d/chemicalAccident/output_chemicalAccident2D/JsonIndex2D.json",
				renderingColorType : 2, // 0= rainbow, 1= monotone, 2= legendColors.***
				renderBorder : true,
				textureFilterType : 0 // 0= nearest, 1= linear.***
			};
			magoManager.chemicalAccident2dManager = new Mago3D.ChemicalAccident2DManager(options);
			magoManager.chemicalAccident2dManager._animationState = Mago3D.CODE.processState.STARTED;

			var minValue = 0.0;
			var maxValue = 0.648;
			var numColors = 12;
			var accentuationFactor = 15.0;
			var legendValues = getLogDivisions(minValue, maxValue, numColors, accentuationFactor);

			// create legend colors.***
			var legendColors = [];
			var LegendColor = new Mago3D.ColorLegend(0/255, 0/255, 143/255, 128/255, legendValues[0]);  // 0
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(0/255, 15/255, 255/255, 128/255, legendValues[1]);  // 1
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(0/255, 95/255, 255/255, 128/255, legendValues[2]);  // 2
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(0/255, 175/255, 255/255, 128/255, legendValues[3]);  // 3
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(0/255, 255/255, 255/255, 128/255, legendValues[4]);  // 4
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(79/255, 255/255, 175/255, 128/255, legendValues[5]);  // 5
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(159/255, 255/255, 95/255, 128/255, legendValues[6]);  // 6
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(239/255, 255/255, 15/255, 128/255, legendValues[7]);  // 7
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(255/255, 191/255, 0/255, 128/255, legendValues[8]);  // 8
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(255/255, 111/255, 0/255, 128/255, legendValues[9]);  // 9
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(255/255, 31/255, 0/255, 128/255, legendValues[10]);  // 10
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(207/255, 0/255, 0/255, 128/255, legendValues[11]);  // 11
			legendColors.push(LegendColor);

			magoManager.chemicalAccident2dManager.setLegendColors(legendColors);

			var options = {
				timeScale : 2000,
				year : 2024,
				month : 2, // 0 to 11
				day : 6,
				hour : 11,
				minute : 0,
				second : 0
			};

			if(magoManager.animationTimeController === undefined)
			{
				magoManager.animationTimeController = new Mago3D.AnimationTimeController(options);
			}

			magoManager.animationTimeController.reset(options);
			magoManager.animationTimeController.startAnimation();
		}

		var hola = 0;
	};

	function getLogDivisions(minValue, maxValue, numberOfColors, accentuationFactor) {
		const logMin = Math.log(minValue + 1); // Evitar log(0)
		const logMax = Math.log(maxValue + 1);
		const logRange = logMax - logMin;
		const divisions = [];
		
		for (let i = 0; i <= numberOfColors; i++) {
			const normalizedValue = i / numberOfColors;
			const accentuatedValue = Math.pow(normalizedValue, accentuationFactor);
			const logValue = logMin + accentuatedValue * logRange;
			const value = Math.exp(logValue) - 1;
			divisions.push(value);
		}
		
		return divisions;
	}
	

	function Chemical_Accident_Test (){ // 
		var magoManager = MAGO3D_INSTANCE.getMagoManager();

		// // to selesct & move native objects.*************************************
		// this.defaultSelectInteraction.setActive(true); // test son 20240318
		// this.defaultSelectInteraction.setTargetType(DataType.NATIVE);

		// this.defaultTranslateInteraction.setActive(true);
		// this.defaultTranslateInteraction.setTargetType(DataType.NATIVE);
		magoManager.interactionCollection.array[0].setActive(true);
		magoManager.interactionCollection.array[0].setTargetType(Mago3D.DataType.NATIVE);
		magoManager.interactionCollection.array[1].setActive(true);
		magoManager.interactionCollection.array[1].setTargetType(Mago3D.DataType.NATIVE);

		// create chemicalAccidentManager, if no exist.***
		if(!magoManager.chemicalAccidentManager)
		{
			var options = {
				magoManager : magoManager,
				url : "/f4d/chemicalAccident/output_chemicalAccident/JsonIndex.json",
				renderingColorType : 2, // 0= rainbow, 1= monotone, 2= legendColors.***
			};
			magoManager.chemicalAccidentManager = new Mago3D.ChemicalAccidentManager(options);
			magoManager.chemicalAccidentManager._animationState = Mago3D.CODE.processState.STARTED;

			// create legend colors.***
			var minValue = 0.0;
			var maxValue = 0.648;
			var numColors = 12;
			var accentuationFactor = 15.0;
			var legendValues = getLogDivisions(minValue, maxValue, numColors, accentuationFactor);
			var accentuationFactorAlpha = 3.0;
			var alphaValues = getLogDivisions(0.0, 0.99, numColors, accentuationFactorAlpha);

			// create legend colors.***
			// var legendColors = [];
			// var LegendColor = new Mago3D.ColorLegend(0/255, 0/255, 143/255, alphaValues[0], legendValues[0]);  // 0
			// legendColors.push(LegendColor);
			// LegendColor = new Mago3D.ColorLegend(0/255, 15/255, 255/255, alphaValues[1], legendValues[1]);  // 1
			// legendColors.push(LegendColor);
			// LegendColor = new Mago3D.ColorLegend(0/255, 95/255, 255/255, alphaValues[2], legendValues[2]);  // 2
			// legendColors.push(LegendColor);
			// LegendColor = new Mago3D.ColorLegend(0/255, 175/255, 255/255, alphaValues[3], legendValues[3]);  // 3
			// legendColors.push(LegendColor);
			// LegendColor = new Mago3D.ColorLegend(0/255, 255/255, 255/255, alphaValues[4], legendValues[4]);  // 4
			// legendColors.push(LegendColor);
			// LegendColor = new Mago3D.ColorLegend(79/255, 255/255, 175/255, alphaValues[5], legendValues[5]);  // 5
			// legendColors.push(LegendColor);
			// LegendColor = new Mago3D.ColorLegend(159/255, 255/255, 95/255, alphaValues[6], legendValues[6]);  // 6
			// legendColors.push(LegendColor);
			// LegendColor = new Mago3D.ColorLegend(239/255, 255/255, 15/255, alphaValues[7], legendValues[7]);  // 7
			// legendColors.push(LegendColor);
			// LegendColor = new Mago3D.ColorLegend(255/255, 191/255, 0/255, alphaValues[8], legendValues[8]);  // 8
			// legendColors.push(LegendColor);
			// LegendColor = new Mago3D.ColorLegend(255/255, 111/255, 0/255, alphaValues[9], legendValues[9]);  // 9
			// legendColors.push(LegendColor);
			// LegendColor = new Mago3D.ColorLegend(255/255, 31/255, 0/255, alphaValues[10], legendValues[10]);  // 10
			// legendColors.push(LegendColor);
			// LegendColor = new Mago3D.ColorLegend(207/255, 0/255, 0/255, alphaValues[11], legendValues[11]);  // 11
			// legendColors.push(LegendColor);

			// magoManager.chemicalAccidentManager.setLegendColors(legendColors);

			// create legend colors mode 2.***
			var legendColors = [];
			var LegendColor = new Mago3D.ColorLegend(0/255, 0/255, 143/255, 0.0, legendValues[0]);  // 0
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(0/255, 15/255, 255/255, 0.0, legendValues[1]);  // 1
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(0/255, 95/255, 255/255, 0.0, legendValues[2]);  // 2
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(0/255, 175/255, 255/255, 0.0, legendValues[3]);  // 3
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(0/255, 255/255, 255/255, 0.0, legendValues[4]);  // 4
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(79/255, 255/255, 175/255, 0.0, legendValues[5]);  // 5
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(159/255, 255/255, 95/255, alphaValues[6], legendValues[6]);  // 6
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(239/255, 255/255, 15/255, alphaValues[7], legendValues[7]);  // 7
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(255/255, 191/255, 0/255, alphaValues[8], legendValues[8]);  // 8
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(255/255, 111/255, 0/255, alphaValues[9], legendValues[9]);  // 9
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(255/255, 31/255, 0/255, alphaValues[10], legendValues[10]);  // 10
			legendColors.push(LegendColor);
			LegendColor = new Mago3D.ColorLegend(207/255, 0/255, 0/255, alphaValues[11], legendValues[11]);  // 11
			legendColors.push(LegendColor);

			magoManager.chemicalAccidentManager.setLegendColors(legendColors);

			var options = {
				timeScale : 2000,
				year : 2024,
				month : 2, // 0 to 11
				day : 6,
				hour : 11,
				minute : 0,
				second : 0
			};

			if(magoManager.animationTimeController === undefined)
			{
				magoManager.animationTimeController = new Mago3D.AnimationTimeController(options);
			}

			magoManager.animationTimeController.reset(options);
			magoManager.animationTimeController.startAnimation();
		}

		var hola = 0;
	}

	function swapTextureFilterType()
	{
		var magoManager = MAGO3D_INSTANCE.getMagoManager();
		if(magoManager.chemicalAccident2dManager !== undefined)
		{
			var firstLayer = magoManager.chemicalAccident2dManager.getChemicalAccident2DLayer(0);
			var texFilterType = firstLayer.getTextureFilterType();
			// textureFilterType = 0 : nearest, 1 : linear.***
			if(texFilterType === 0)
			{
				texFilterType = 1;
			}
			else if(texFilterType === 1)
			{
				texFilterType = 0;
			}

			magoManager.chemicalAccident2dManager.setTextureFilterType(texFilterType);
		}
	}

	function swapRenderBorder()
	{
		var magoManager = MAGO3D_INSTANCE.getMagoManager();
		if(magoManager.chemicalAccident2dManager !== undefined)
		{
			var firstLayer = magoManager.chemicalAccident2dManager.getChemicalAccident2DLayer(0);
			var renderBorder = firstLayer.getRenderBorder();

			if(renderBorder === false)
			{
				renderBorder = true;
			}
			else if(renderBorder === true)
			{
				renderBorder = false;
			}

			magoManager.chemicalAccident2dManager.setRenderBorder(renderBorder);
		}
	}

	function swapRenderColorType2D()
	{
		var magoManager = MAGO3D_INSTANCE.getMagoManager();
		if(magoManager.chemicalAccident2dManager !== undefined)
		{
			var firstLayer = magoManager.chemicalAccident2dManager.getChemicalAccident2DLayer(0);
			var renderColorType = firstLayer.getRenderingColorType();

			if(renderColorType === 0)
			{
				renderColorType = 1;
			}
			else if(renderColorType === 1)
			{
				renderColorType = 2;
			}
			else if(renderColorType === 2)
			{
				renderColorType = 0;
			}

			magoManager.chemicalAccident2dManager.setRenderingColorType(renderColorType);
		}
	
	}
	function swapRenderColorType3D()
	{
		var magoManager = MAGO3D_INSTANCE.getMagoManager();
		if(magoManager.chemicalAccidentManager !== undefined)
		{
			var firstLayer = magoManager.chemicalAccidentManager.getChemicalAccidentLayer(0);
			var renderColorType = firstLayer.getRenderingColorType();

			if(renderColorType === 0)
			{
				renderColorType = 1;
			}
			else if(renderColorType === 1)
			{
				renderColorType = 2;
			}
			else if(renderColorType === 2)
			{
				renderColorType = 0;
			}

			magoManager.chemicalAccidentManager.setRenderingColorType(renderColorType);
		}
	
	}

	function swapIsDoRender3d()
	{
		var magoManager = MAGO3D_INSTANCE.getMagoManager();
		if(magoManager.chemicalAccidentManager !== undefined)
		{
			var currIsDoRender = magoManager.chemicalAccidentManager.isShow();

			if(currIsDoRender === true)
			{
				magoManager.chemicalAccidentManager.hide();
			}
			else if(currIsDoRender === false)
			{
				magoManager.chemicalAccidentManager.show();
			}
		}
	
	}

	function swapIsDoRender2d()
	{
		var magoManager = MAGO3D_INSTANCE.getMagoManager();
		if(magoManager.chemicalAccident2dManager !== undefined)
		{
			var currIsDoRender = magoManager.chemicalAccident2dManager.isShow();

			if(currIsDoRender === true)
			{
				magoManager.chemicalAccident2dManager.hide();
			}
			else if(currIsDoRender === false)
			{
				magoManager.chemicalAccident2dManager.show();
			}

		}
	
	}

	const ArchInfoController = function (archInfoList, magoManager) {
		this.hash = {};
		this.magoManager = magoManager;
	}

	ArchInfoController.prototype.getArchInfoById = function(id) {
		return this.hash[id];
	}

	ArchInfoController.createMockData = function(magoManager) {
		
		let getUrl = function(name) {
			return `https://mago3d.net/buildings/${name}/15/`;
		}

		let archInfoList = [];
		const info = [
			{name : '강원', format : 'pbf', option:{show:true}},
			{name : '세종', format : 'pbf', option:{show:true}},
			{name : '경기', format : 'geojson', option:{show:true}},
			{name : '경남', format : 'geojson', option:{show:true}},
			{name : '경북', format : 'geojson', option:{show:true}},
			{name : '광주', format : 'geojson', option:{show:true}},
			{name : '대구', format : 'geojson', option:{show:true}},
			{name : '대전', format : 'geojson', option:{show:true}},
			{name : '부산', format : 'geojson', option:{show:true}},
			{name : '서울', format : 'geojson', option:{show:true}},
			{name : '울산', format : 'geojson', option:{show:true}},
			{name : '인천', format : 'geojson', option:{show:true}},
			{name : '전남', format : 'geojson', option:{show:true}},
			{name : '전북', format : 'geojson', option:{show:true}},
			{name : '제주', format : 'geojson', option:{show:true}},
			{name : '충남', format : 'geojson', option:{show:true}},
			{name : '충북', format : 'geojson', option:{show:true}}
		]
		
		for(let i in info) {
			let archInfo = info[i];
			archInfo.url = getUrl(archInfo.name);
			archInfo.option.color = new Mago3D.Color(200/255, 200/255, 200/255 ,1);
			archInfoList.push(new ArchInfo(archInfo, magoManager));
		}
		
		return archInfoList;
		
	}

	

	const ArchInfo = function(contructionOption, magoManager) {
		this.name = contructionOption.name;
		this.buildingMaster = magoManager.addKoreaBuildingMaster(contructionOption.url, contructionOption.format, contructionOption.option);
	}

	

	Object.defineProperties(ArchInfo.prototype, {
		show : {
			get : function() {
				return this.buildingMaster.show;
			},
			set : function(show) {
				this.buildingMaster.show = show;
			}
		},
		color : {
			get : function() {
				return this.buildingMaster.color;
			},
			set : function(color) {
				this.buildingMaster.color = color;
			}
		}
	});
	

</script>
</body>
</html>